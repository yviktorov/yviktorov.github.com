---
layout: post
title: Using sfWidgetFormReCaptcha with ajax enabled forms
categories: [symfony]
truncatewords: 18
---

In this post I wold like to make a note about usage of [sfWidgetFormReCaptcha][1] with ajax enabled forms.

The [sfWidgetFormReCaptcha][1] renders a [ReCaptcha][3] widget, i.e. let you protect your forms with visual code generated by [ReCaptcha][3], but I assume you already familiar with this widget, [visit plugin page][2] if not ;)

Current implementation will not work out of box with ajax enabled forms, because, [according implementation][1], ajax response will include link to external resource, e.g. `recaptcha_ajax.js`, and browser will throw security issue.

## Solution

Remove `recaptcha_ajax.js` inclusion from widget and put into header of your page.

### Step 1. Create sfWidgetFormReCaptcha2

We will be creating `sfWidgetFormReCaptcha2.class.php` file which simply extends original `sfWidgetFormReCaptcha` and overrides `render(...)` method. You can put into `apps/frontend/lib/widget/`.

<script src="http://gist.github.com/369216.js">
</script>

### Step 2. Modify your form class

Modify your form class and add following, e.g. simply replace `sfWidgetFormReCaptcha` to `sfWidgetFormReCaptcha2`

<script src="http://gist.github.com/369218.js">
</script>

**NOTE:** The usage of ReCaptcha widget and validator explained [here][4]

### Step 3. Include ReCaptcha api

For example, put into your template ;)

<script src="http://gist.github.com/369219.js">
</script>

**NOTE:** Above template must be processed with regular(non ajax) response at least once, i.e. first time page requested!

[1]: http://trac.symfony-project.org/browser/plugins/sfFormExtraPlugin/lib/widget/sfWidgetFormReCaptcha.class.php
[2]: http://www.symfony-project.org/plugins/sfFormExtraPlugin
[3]: http://recaptcha.net/
[4]: http://www.symfony-project.org/blog/2008/10/18/spice-up-your-forms-with-some-nice-widgets-and-validators
